(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}const o=function(){function o(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["#000","#00f","#0f0","#0ff","#f00","#f0f"];t(this,o),this.rows=e,this.cols=r,this.variety=i,this.colors=c,0==n.length&&s.length>0?(this.grid=s.slice(),this.resetGrid=s.slice()):(this.grid=n.slice(),this.resetGrid=s.slice()),this.moves=l.slice(),this.bitWidth=$(".bit").width(),this.bitMargin=parseInt($(".bit").css("margin-right")),this.mode="plain",this.draw()}var r,i;return r=o,(i=[{key:"newBoard",value:function(){this.resetGrid=[],this.moves=[],this.draw()}},{key:"saveGridAndMoves",value:function(){localStorage.setItem("grid",this.grid),localStorage.setItem("moves",this.moves)}},{key:"saveAll",value:function(){localStorage.setItem("rows",this.rows),localStorage.setItem("cols",this.cols),localStorage.setItem("variety",this.variety),localStorage.setItem("grid",this.grid),localStorage.setItem("moves",this.moves),localStorage.setItem("reset-grid",this.resetGrid)}},{key:"draw",value:function(){var t=this,e=0;$("#status").empty(),$("#board").empty();for(var o="".concat(this.bitWidth*this.cols+this.bitMargin*this.cols,"px"),r=0;r<this.rows;r++){var i=[],n="";n+='<div id="bitRow" style="width:'.concat(o,';">');for(var s=0;s<this.cols;s++,e++)0==this.resetGrid.length?n+='<div id="'.concat(e,'" class="bit" style="background-color:').concat(this.colors[0],';"></div>'):this.grid.length>0?n+='<div id="'.concat(e,'" class="bit" style="background-color:').concat(this.colors[this.grid[e]],';"></div>'):n+='<div id="'.concat(e,'" class="bit" style="background-color:').concat(this.colors[this.resetGrid[e]],';"></div>'),i.push(e);$("#board").append(n),i.forEach((function(e){return $("#".concat(e)).bind("click",(function(){return t.flipBits(e)}))}))}for(var l="",c=0;c<this.variety;c++)l+='<div class="miniBit" style="background-color:'.concat(this.colors[c],';"></div>');for(l+="</div>",$("#pattern").html(l);this.grid.length<this.cols*this.rows;)this.grid.push(0);0==this.resetGrid.length&&(this.randomize(),this.grid.forEach((function(e,o){return t.resetGrid[o]=e})),this.saveAll())}},{key:"randomize",value:function(){for(var t=this.rows*this.cols,e=0;e<5*t;e++)this.modeReverseFlip(this.rand(t))}},{key:"rand",value:function(t){return Math.floor(Math.random()*t)}},{key:"resetBoard",value:function(){var t=this;this.resetGrid.forEach((function(e,o){return t.grid[o]=e})),this.resetGrid.forEach((function(e,o){$("#".concat(o)).css("background-color",t.colors[e])})),this.saveGridAndMoves()}},{key:"flipBits",value:function(t){this.modeFlip(t),this.moves.push(t),this.solved(),this.saveGridAndMoves()}},{key:"modeFlip",value:function(t){this.flip(t)}},{key:"modeReverseFlip",value:function(t){this.reverseFlip(t)}},{key:"flip",value:function(t){this.grid[t]=(this.grid[t]+1)%this.variety,$("#".concat(t)).css("background-color",this.colors[this.grid[t]%this.variety])}},{key:"reverseFlip",value:function(t){this.grid[t]=this.grid[t]-1,this.grid[t]<0&&(this.grid[t]=this.variety-1),$("#".concat(t)).css("background-color",this.colors[this.grid[t]%this.variety])}},{key:"getRow",value:function(t){return Math.floor(t/this.cols)}},{key:"solved",value:function(){var t=this;this.grid.every((function(t){return 0===t}))&&($("#status").html("Solved in ".concat(this.moves.length," moves! <br/>")+'<button id="replay-button">Replay</button><button id="pl-button">Permalink</button><input type="text" id="pl" size="25"> </input>'),$("#pl-button").bind("click",(function(){t.genPermalink()})),$("#replay-button").bind("click",(function(){t.replay()})))}},{key:"replay",value:function(){var t=this;this.resetBoard();for(var e=0,o=this.moves.length,r=Math.min(1e4/o,500),i=0;i<o;i++)setTimeout((function(e){t.modeFlip(e)}),e+=r,this.moves[i])}},{key:"genPermalink",value:function(){var t="?".concat(this.mode,"+").concat(this.variety,"+").concat(this.rows,"+").concat(this.cols,"+");t+="".concat(this.resetGrid.join(""),"+").concat(this.moves.join(",")),$("#pl").val(document.location.origin+document.location.pathname+t),$("#pl").select()}}])&&e(r.prototype,i),Object.defineProperty(r,"prototype",{writable:!1}),o}();function r(t){return r="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},r(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function l(t,e){if(e&&("object"===r(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}const a=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(f,t);var e,o,r,a,u=(r=f,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(r);if(a){var o=c(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return l(this,t)});function f(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["#000","#00f","#0f0","#0ff","#f00","#f0f"];return i(this,f),(t=u.call(this,e,o,r,n,s,l,c)).mode="adjacent",t}return e=f,(o=[{key:"modeFlip",value:function(t){this.flipAdjacent(t)}},{key:"modeReverseFlip",value:function(t){this.reverseAdjacentFlip(t)}},{key:"flipAdjacent",value:function(t){this.flip(t),t-this.cols>=0&&this.flip(t-this.cols),t+this.cols<this.grid.length&&this.flip(t+this.cols),this.getRow(t)===this.getRow(t-1)&&this.flip(t-1),this.getRow(t)===this.getRow(t+1)&&this.flip(t+1)}},{key:"reverseAdjacentFlip",value:function(t){this.reverseFlip(t),t-this.cols>=0&&this.reverseFlip(t-this.cols),t+this.cols<this.grid.length&&this.reverseFlip(t+this.cols),this.getRow(t)===this.getRow(t-1)&&this.reverseFlip(t-1),this.getRow(t)===this.getRow(t+1)&&this.reverseFlip(t+1)}}])&&n(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),f}(o);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}function d(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}const y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}(s,t);var e,o,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=v(r);if(i){var o=v(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return d(this,t)});function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["#000","#00f","#0f0","#0ff","#f00","#f0f"];return f(this,s),(t=n.call(this,e,o,r,i,l,c,a)).mode="star",t}return e=s,(o=[{key:"modeFlip",value:function(t){this.flipStar(t)}},{key:"modeReverseFlip",value:function(t){this.reverseFlipStar(t)}},{key:"flipStar",value:function(t){this.flip(t);for(var e=1;t-this.cols*e>=0;e++)this.flip(t-this.cols*e);for(var o=1;t+this.cols*o<this.grid.length;o++)this.flip(t+this.cols*o);for(var r=1;this.getRow(t)===this.getRow(t-r);r++)this.flip(t-r);for(var i=1;this.getRow(t)===this.getRow(t+i);i++)this.flip(t+i)}},{key:"reverseFlipStar",value:function(t){this.reverseFlip(t);for(var e=1;t-this.cols*e>=0;e++)this.reverseFlip(t-this.cols*e);for(var o=1;t+this.cols*o<this.grid.length;o++)this.reverseFlip(t+this.cols*o);for(var r=1;this.getRow(t)==this.getRow(t-r);r++)console.log(t,r,t-r),this.reverseFlip(t-r);for(var i=1;this.getRow(t)==this.getRow(t+i);i++)this.reverseFlip(t+i)}}])&&h(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),s}(o);function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function w(t,e){return w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},w(t,e)}function R(t,e){if(e&&("object"===g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}const S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(s,t);var e,o,r,i,n=(r=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=k(r);if(i){var o=k(this).constructor;t=Reflect.construct(e,arguments,o)}else t=e.apply(this,arguments);return R(this,t)});function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["#000","#00f","#0f0","#0ff","#f00","#f0f"];return b(this,s),(t=n.call(this,e,o,r,i,l,c,a)).mode="double",t}return e=s,(o=[{key:"modeFlip",value:function(t){this.flipDouble(t)}},{key:"modeReverseFlip",value:function(t){this.reverseFlipDouble(t)}},{key:"flipDouble",value:function(t){this.flip(t),t-this.cols>=0&&(this.flip(t-this.cols),this.flip(t-this.cols)),t+this.cols<this.grid.length&&(this.flip(t+this.cols),this.flip(t+this.cols)),this.getRow(t)===this.getRow(t-1)&&(this.flip(t-1),this.flip(t-1)),this.getRow(t)===this.getRow(t+1)&&(this.flip(t+1),this.flip(t+1))}},{key:"reverseFlipDouble",value:function(t){this.reverseFlip(t),t-this.cols>=0&&(this.reverseFlip(t-this.cols),this.reverseFlip(t-this.cols)),t+this.cols<this.grid.length&&(this.reverseFlip(t+this.cols),this.reverseFlip(t+this.cols)),this.getRow(t)===this.getRow(t-1)&&(this.reverseFlip(t-1),this.reverseFlip(t-1)),this.getRow(t)===this.getRow(t+1)&&(this.reverseFlip(t+1),this.reverseFlip(t+1))}}])&&m(e.prototype,o),Object.defineProperty(e,"prototype",{writable:!1}),s}(o);function j(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var o=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=o){var r,i,n=[],s=!0,l=!1;try{for(o=o.call(t);!(s=(r=o.next()).done)&&(n.push(r.value),!e||n.length!==e);s=!0);}catch(t){l=!0,i=t}finally{try{s||null==o.return||o.return()}finally{if(l)throw i}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return O(t,e);var o=Object.prototype.toString.call(t).slice(8,-1);return"Object"===o&&t.constructor&&(o=t.constructor.name),"Map"===o||"Set"===o?Array.from(t):"Arguments"===o||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(o)?O(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function O(t,e){(null==e||e>t.length)&&(e=t.length);for(var o=0,r=new Array(e);o<e;o++)r[o]=t[o];return r}!function(){var t=this,e={},o="adjacent",r={0:a,adjacent:a,1:y,star:y,2:S,double:S},i=$("#rowsDropdown"),n=$("#colsDropdown"),s=$("#varietyDropdown");function l(){var t=j([i,n,s].map((function(t){return parseInt(t.val(),10)})),3),l=t[0],c=t[1],a=t[2];e=new r[o](l,c,a),localStorage.setItem("mode",o)}i.bind("change",l),n.bind("change",l),s.bind("change",l),$("#modeDropdown").bind("change",(function(t){o=t.target.value,l()})),$("#resetButton").bind("click",(function(){e.resetBoard(),t.moves=[]})),$("#newButton").bind("click",(function(){e.newBoard()}));var c=document.location.href;if(".html"===c.substr(-5)||"/"===c.substr(-1)){console.log("restoring from localStorage");var u=function(){var t=localStorage.getItem("mode");if(!t)return!1;var e=parseInt(localStorage.getItem("rows")),o=parseInt(localStorage.getItem("cols")),r=parseInt(localStorage.getItem("variety")),i=localStorage.getItem("grid").split(",").map((function(t){return parseInt(t,10)})),n=localStorage.getItem("reset-grid").split(",").map((function(t){return parseInt(t,10)})),s=localStorage.getItem("reset-grid").split(",").map((function(t){return parseInt(t,10)}));return!!(t&&e&&o&&r&&i&&n&&s)&&{mode:t,rows:e,cols:o,variety:r,grid:i,resetGrid:n,moves:s}}();0!=u?e=new r[u.mode](u.rows,u.cols,u.variety,u.grid,u.resetGrid,u.moves):(e=new r[o](3,3,2),localStorage.setItem("mode",o))}else{console.log("restoring from url");var f=j(c.split("?")[1].split("+"),6),h=f[0],p=f[1],d=f[2],v=f[3],g=f[4],b=f[5];p=parseInt(p,10),d=parseInt(d,10),v=parseInt(v,10),g=g.split("").map((function(t){return parseInt(t,10)})),b=b.split(",").map((function(t){return parseInt(t,10)})),console.log(h,p,d,v,g,b),e=new r[h](d,v,p,[],g,b),setTimeout((function(){e.replay()}),1e3),$("#status").html("Replay of ".concat(b.length," moves."))}}()})();