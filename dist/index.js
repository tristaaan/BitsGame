(()=>{"use strict";function t(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function e(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}const r=function(){function r(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["#000","#00f","#0f0","#0ff","#f00","#f0f"];t(this,r),this.rows=e,this.cols=o,this.variety=i,this.colors=c,0==n.length&&s.length>0?(this.grid=s.slice(),this.resetGrid=s.slice()):(this.grid=n.slice(),this.resetGrid=s.slice()),this.moves=l.slice(),this.bitWidth=$(".bit").width(),this.bitMargin=parseInt($(".bit").css("margin-right")),this.mode="plain",this.draw()}var o,i;return o=r,(i=[{key:"newBoard",value:function(){this.resetGrid=[],this.moves=[],this.draw()}},{key:"saveGridAndMoves",value:function(){localStorage.setItem("grid",this.grid),localStorage.setItem("moves",this.moves)}},{key:"saveAll",value:function(){localStorage.setItem("rows",this.rows),localStorage.setItem("cols",this.cols),localStorage.setItem("variety",this.variety),localStorage.setItem("grid",this.grid),localStorage.setItem("moves",this.moves),localStorage.setItem("reset-grid",this.resetGrid)}},{key:"draw",value:function(){var t=this,e=0;$("#status").empty(),$("#board").empty();for(var r="".concat(this.bitWidth*this.cols+this.bitMargin*this.cols,"px"),o=0;o<this.rows;o++){var i=[],n="";n+='<div id="bitRow" style="width:'.concat(r,';">');for(var s=0;s<this.cols;s++,e++)0==this.resetGrid.length?n+='<div id="'.concat(e,'" class="bit" style="background-color:').concat(this.colors[0],';"></div>'):this.grid.length>0?n+='<div id="'.concat(e,'" class="bit" style="background-color:').concat(this.colors[this.grid[e]],';"></div>'):n+='<div id="'.concat(e,'" class="bit" style="background-color:').concat(this.colors[this.resetGrid[e]],';"></div>'),i.push(e);$("#board").append(n),i.forEach((function(e){return $("#".concat(e)).bind("click",(function(){return t.flipBits(e)}))}))}for(var l="",c=0;c<this.variety;c++)l+='<div class="miniBit" style="background-color:'.concat(this.colors[c],';"></div>');for(l+="</div>",$("#pattern").html(l);this.grid.length<this.cols*this.rows;)this.grid.push(0);0==this.resetGrid.length&&(this.randomize(),this.grid.forEach((function(e,r){return t.resetGrid[r]=e})),this.saveAll())}},{key:"randomize",value:function(){for(var t=this.rows*this.cols,e=0;e<5*t;e++)this.modeReverseFlip(this.rand(t))}},{key:"rand",value:function(t){return Math.floor(Math.random()*t)}},{key:"resetBoard",value:function(){var t=this;this.resetGrid.forEach((function(e,r){return t.grid[r]=e})),this.resetGrid.forEach((function(e,r){$("#".concat(r)).css("background-color",t.colors[e]),console.log(e,t.colors[e])})),this.saveGridAndMoves()}},{key:"flipBits",value:function(t){this.modeFlip(t),this.moves.push(t),this.solved(),this.saveGridAndMoves()}},{key:"modeFlip",value:function(t){this.flip(t)}},{key:"modeReverseFlip",value:function(t){this.reverseFlip(t)}},{key:"flip",value:function(t){this.grid[t]=(this.grid[t]+1)%this.variety,$("#".concat(t)).css("background-color",this.colors[this.grid[t]%this.variety])}},{key:"reverseFlip",value:function(t){this.grid[t]=this.grid[t]-1,this.grid[t]<0&&(this.grid[t]=this.variety-1),$("#".concat(t)).css("background-color",this.colors[this.grid[t]%this.variety])}},{key:"getRow",value:function(t){return Math.floor(t/this.cols)}},{key:"solved",value:function(){var t=this;this.grid.every((function(t){return 0===t}))&&($("#status").html("Solved in ".concat(this.moves.length," moves! <br/>")+'<button id="replay-button">Replay</button><button id="pl-button">Permalink</button><input type="text" id="pl" size="25"> </input>'),$("#pl-button").bind("click",(function(){t.genPermalink()})),$("#replay-button").bind("click",(function(){t.replay()})))}},{key:"replay",value:function(){var t=this;this.resetBoard();for(var e=0,r=this.moves.length,o=Math.min(1e4/r,500),i=0;i<r;i++)setTimeout((function(e){t.modeFlip(e)}),e+=o,this.moves[i])}},{key:"genPermalink",value:function(){var t=this,e="?".concat(this.mode,"+").concat(this.variety,"+").concat(this.rows,"+").concat(this.cols,"+");this.resetGrid.forEach((function(t){return e+=t})),e+="+",this.moves.forEach((function(r,o){o===t.moves.length-1?e+=r:e+="".concat(r,",")})),$("#pl").val(document.location.origin+document.location.pathname+e),$("#pl").select()}}])&&e(o.prototype,i),Object.defineProperty(o,"prototype",{writable:!1}),r}();function o(t){return o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},o(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function n(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function s(t,e){return s=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},s(t,e)}function l(t,e){if(e&&("object"===o(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function c(t){return c=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},c(t)}const a=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&s(t,e)}(f,t);var e,r,o,a,u=(o=f,a=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=c(o);if(a){var r=c(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return l(this,t)});function f(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],l=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],c=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["#000","#00f","#0f0","#0ff","#f00","#f0f"];return i(this,f),(t=u.call(this,e,r,o,n,s,l,c)).mode="adjacent",t}return e=f,(r=[{key:"modeFlip",value:function(t){this.flipAdjacent(t)}},{key:"modeReverseFlip",value:function(t){this.reverseAdjacentFlip(t)}},{key:"flipAdjacent",value:function(t){this.flip(t),t-this.cols>=0&&this.flip(t-this.cols),t+this.cols<this.grid.length&&this.flip(t+this.cols),this.getRow(t)===this.getRow(t-1)&&this.flip(t-1),this.getRow(t)===this.getRow(t+1)&&this.flip(t+1)}},{key:"reverseAdjacentFlip",value:function(t){this.reverseFlip(t),t-this.cols>=0&&this.reverseFlip(t-this.cols),t+this.cols<this.grid.length&&this.reverseFlip(t+this.cols),this.getRow(t)===this.getRow(t-1)&&this.reverseFlip(t-1),this.getRow(t)===this.getRow(t+1)&&this.reverseFlip(t+1)}}])&&n(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),f}(r);function u(t){return u="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},u(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function h(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function p(t,e){return p=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},p(t,e)}function d(t,e){if(e&&("object"===u(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function v(t){return v=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},v(t)}const y=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&p(t,e)}(s,t);var e,r,o,i,n=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=v(o);if(i){var r=v(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return d(this,t)});function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["#000","#00f","#0f0","#0ff","#f00","#f0f"];return f(this,s),(t=n.call(this,e,r,o,i,l,c,a)).mode="star",t}return e=s,(r=[{key:"modeFlip",value:function(t){this.flipStar(t)}},{key:"modeReverseFlip",value:function(t){this.reverseFlipStar(t)}},{key:"flipStar",value:function(t){this.flip(t);for(var e=1;t-this.cols*e>=0;e++)this.flip(t-this.cols*e);for(var r=1;t+this.cols*r<this.grid.length;r++)this.flip(t+this.cols*r);for(var o=1;this.getRow(t)===this.getRow(t-o);o++)this.flip(t-o);for(var i=1;this.getRow(t)===this.getRow(t+i);i++)this.flip(t+i)}},{key:"reverseFlipStar",value:function(t){this.reverseFlip(t);for(var e=1;t-this.cols*e>=0;e++)this.reverseFlip(t-this.cols*e);for(var r=1;t+this.cols*r<this.grid.length;r++)this.reverseFlip(t+this.cols*r);for(var o=1;this.getRow(t)==this.getRow(t-o);o++)console.log(t,o,t-o),this.reverseFlip(t-o);for(var i=1;this.getRow(t)==this.getRow(t+i);i++)this.reverseFlip(t+i)}}])&&h(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(r);function g(t){return g="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},g(t)}function b(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function m(t,e){for(var r=0;r<e.length;r++){var o=e[r];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function w(t,e){return w=Object.setPrototypeOf||function(t,e){return t.__proto__=e,t},w(t,e)}function R(t,e){if(e&&("object"===g(e)||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(t){if(void 0===t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}(t)}function k(t){return k=Object.setPrototypeOf?Object.getPrototypeOf:function(t){return t.__proto__||Object.getPrototypeOf(t)},k(t)}const S=function(t){!function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),e&&w(t,e)}(s,t);var e,r,o,i,n=(o=s,i=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}(),function(){var t,e=k(o);if(i){var r=k(this).constructor;t=Reflect.construct(e,arguments,r)}else t=e.apply(this,arguments);return R(this,t)});function s(){var t,e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:3,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],l=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],c=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:["#000","#00f","#0f0","#0ff","#f00","#f0f"];return b(this,s),(t=n.call(this,e,r,o,i,l,c,a)).mode="double",t}return e=s,(r=[{key:"modeFlip",value:function(t){this.flipDouble(t)}},{key:"modeReverseFlip",value:function(t){this.reverseFlipDouble(t)}},{key:"flipDouble",value:function(t){this.flip(t),t-this.cols>=0&&(this.flip(t-this.cols),this.flip(t-this.cols)),t+this.cols<this.grid.length&&(this.flip(t+this.cols),this.flip(t+this.cols)),this.getRow(t)===this.getRow(t-1)&&(this.flip(t-1),this.flip(t-1)),this.getRow(t)===this.getRow(t+1)&&(this.flip(t+1),this.flip(t+1))}},{key:"reverseFlipDouble",value:function(t){this.reverseFlip(t),t-this.cols>=0&&(this.reverseFlip(t-this.cols),this.reverseFlip(t-this.cols)),t+this.cols<this.grid.length&&(this.reverseFlip(t+this.cols),this.reverseFlip(t+this.cols)),this.getRow(t)===this.getRow(t-1)&&(this.reverseFlip(t-1),this.reverseFlip(t-1)),this.getRow(t)===this.getRow(t+1)&&(this.reverseFlip(t+1),this.reverseFlip(t+1))}}])&&m(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),s}(r);function O(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var o,i,n=[],s=!0,l=!1;try{for(r=r.call(t);!(s=(o=r.next()).done)&&(n.push(o.value),!e||n.length!==e);s=!0);}catch(t){l=!0,i=t}finally{try{s||null==r.return||r.return()}finally{if(l)throw i}}return n}}(t,e)||function(t,e){if(t){if("string"==typeof t)return j(t,e);var r=Object.prototype.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?j(t,e):void 0}}(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,o=new Array(e);r<e;r++)o[r]=t[r];return o}!function(){var t={},e="adjacent",r={0:a,adjacent:a,1:y,star:y,2:S,double:S},o=$("#rowsDropdown"),i=$("#colsDropdown"),n=$("#varietyDropdown");function s(){var s=O([o,i,n].map((function(t){return parseInt(t.val(),10)})),3),l=s[0],c=s[1],a=s[2];t=new r[e](l,c,a),localStorage.setItem("mode",e)}o.bind("change",s),i.bind("change",s),n.bind("change",s),$("#modeDropdown").bind("change",(function(t){e=t.target.value,s()})),$("#resetButton").bind("click",(function(){return t.resetBoard()})),$("#newButton").bind("click",(function(){return t.newBoard()}));var l=document.location.href;if(".html"===l.substr(-5)||"/"===l.substr(-1)){var c=function(){var t=localStorage.getItem("mode");if(!t)return!1;var e=parseInt(localStorage.getItem("rows")),r=parseInt(localStorage.getItem("cols")),o=parseInt(localStorage.getItem("variety")),i=localStorage.getItem("grid").split(",").map((function(t){return parseInt(t,10)})),n=localStorage.getItem("reset-grid").split(",").map((function(t){return parseInt(t,10)})),s=localStorage.getItem("reset-grid").split(",").map((function(t){return parseInt(t,10)}));return!!(t&&e&&r&&o&&i&&n&&s)&&{mode:t,rows:e,cols:r,variety:o,grid:i,resetGrid:n,moves:s}}();0!=c?t=new r[c.mode](c.rows,c.cols,c.variety,c.grid,c.resetGrid,c.moves):(t=new r[e](3,3,2),localStorage.setItem("mode",e))}else{var u=l.split("?")[1].split("+"),f=u[0],h=O(u.map((function(t){return parseInt(t,10)})),4),p=h[1],d=h[2],v=h[3],g=u[4].split("").map((function(t){return parseInt(t,10)})),b=u[5].split(",").map((function(t){return parseInt(t,10)}));t=new r[f](d,v,p,[],g,b),setTimeout((function(){return t.replay()}),1e3),$("#status").html("Replay of ".concat(b.length," moves."))}}()})();